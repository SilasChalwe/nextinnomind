<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Next Game Experience</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '624390414009531');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=624390414009531&ev=PageView&noscript=1"
    /></noscript>
<style>
  :root {
    --primary: #6a11cb;
    --secondary: #2575fc;
    --accent: #ff6b6b;
    --dark: #1a1a2e;
    --light: #f8f9fa;
    --success: #4ade80;
    --warning: #fbbf24;
    --danger: #ef4444;
  }
  
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  
  body {
    background: linear-gradient(135deg, var(--dark), #16213e);
    color: var(--light);
    min-height: 100vh;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    position: relative;
  }
  
  body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, rgba(106, 17, 203, 0.1), transparent 70%);
    pointer-events: none;
    z-index: -1;
  }
  
  .header {
    text-align: center;
    margin: 15px 0;
    width: 100%;
    max-width: 900px;
    animation: fadeInDown 1s ease;
  }
  
  .header h1 {
    font-size: clamp(2.2rem, 6vw, 3.5rem);
    font-weight: 800;
    background: linear-gradient(90deg, var(--accent), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 5px;
    text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  }
  
  .header p {
    font-size: clamp(0.9rem, 2.5vw, 1.2rem);
    opacity: 0.8;
    max-width: 600px;
    margin: 0 auto;
    padding: 0 10px;
  }
  
  .game-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    align-items: flex-start;
    width: 100%;
    max-width: 1200px;
  }
  
  #game-wrapper {
    position: relative;
    width: min(95vw, 500px);
    height: min(65vw, 400px);
    background: linear-gradient(145deg, #1e3c72, #2a5298);
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
    touch-action: manipulation;
    outline: none;
    cursor: pointer;
    border: 2px solid rgba(255, 255, 255, 0.1);
    animation: fadeIn 1s ease;
  }
  
  #baseline {
    position: absolute;
    bottom: min(12vw, 70px);
    left: 0;
    width: 100%;
    height: 6px;
    background: linear-gradient(90deg, var(--warning), var(--accent));
    box-shadow: 0 0 15px var(--warning);
    pointer-events: none;
    border-radius: 3px;
  }
  
  #player {
    position: absolute;
    width: min(8vw, 50px);
    height: min(8vw, 50px);
    background: linear-gradient(135deg, var(--accent), var(--warning));
    border-radius: 50%;
    box-shadow: 0 0 20px var(--accent);
    left: min(12vw, 60px);
    z-index: 10;
    transition: transform 0.2s ease;
  }
  
  .obstacle {
    position: absolute;
    width: min(5vw, 30px);
    background: linear-gradient(180deg, #ff416c, #ff4b2b);
    border-radius: 6px;
    bottom: min(12vw, 70px);
    box-shadow: 0 0 15px rgba(255, 75, 43, 0.7);
    z-index: 5;
  }
  
  #info {
    position: absolute;
    top: min(3vw, 20px);
    left: min(3vw, 20px);
    right: min(3vw, 20px);
    display: flex;
    justify-content: space-between;
    font-size: min(4vw, 24px);
    font-weight: 700;
    color: var(--light);
    pointer-events: none;
    user-select: none;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    background: rgba(0, 0, 0, 0.3);
    padding: min(2vw, 10px) min(4vw, 20px);
    border-radius: 50px;
    backdrop-filter: blur(5px);
  }
  
  #gameOver {
    position: absolute;
    top: 40%;
    width: 100%;
    text-align: center;
    font-size: min(5vw, 3rem);
    font-weight: 900;
    color: var(--light);
    text-shadow: 0 0 15px var(--danger);
    display: none;
    pointer-events: none;
    background: rgba(239, 68, 68, 0.2);
    padding: min(3vw, 20px);
    backdrop-filter: blur(5px);
    z-index: 20;
    padding: 10px;
  }
  
  #levelUp {
    position: absolute;
    top: 30%;
    width: 100%;
    text-align: center;
    font-size: min(5vw, 3rem);
    font-weight: 900;
    color: var(--light);
    text-shadow: 0 0 15px var(--success);
    pointer-events: none;
    opacity: 0;
    z-index: 15;
    background: rgba(74, 222, 128, 0.2);
    padding: min(3vw, 20px);
    backdrop-filter: blur(5px);
    border-radius: 15px;
  }
  
  .controls {
    display: flex;
    gap: 15px;
    margin: 15px 0;
    flex-wrap: wrap;
    justify-content: center;
    animation: fadeInUp 1s ease;
  }
  
  .btn {
    padding: min(3vw, 15px) min(6vw, 30px);
    font-size: min(3.5vw, 1.2rem);
    font-weight: 700;
    color: white;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    border-radius: 50px;
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    user-select: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 120px;
    justify-content: center;
  }
  
  .btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 20px rgba(0, 0, 0, 0.4);
  }
  
  .btn:active {
    transform: translateY(1px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }
  
  .btn.jump {
    background: linear-gradient(135deg, var(--accent), #ff8e53);
  }
  
  .music-panel {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: min(4vw, 25px);
    width: min(95vw, 500px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    animation: fadeIn 1s ease 0.2s forwards;
    opacity: 0;
  }
  
  .music-panel h2 {
    font-size: min(4vw, 1.8rem);
    margin-bottom: min(3vw, 20px);
    color: var(--light);
    text-align: center;
    background: linear-gradient(90deg, var(--accent), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .visualizer {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    height: min(20vw, 100px);
    gap: 3px;
    margin: min(3vw, 20px) 0;
  }
  
  .bar {
    width: min(2vw, 10px);
    background: linear-gradient(to top, var(--primary), var(--secondary));
    border-radius: 5px 5px 0 0;
    transition: height 0.1s ease;
  }
  
  .music-controls {
    display: flex;
    justify-content: center;
    gap: min(2vw, 15px);
    margin-top: min(3vw, 20px);
  }
  
  .music-btn {
    width: min(10vw, 50px);
    height: min(10vw, 50px);
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: white;
    font-size: min(4vw, 1.2rem);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .music-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
  }
  
  .upload-area {
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: 12px;
    padding: min(4vw, 20px);
    text-align: center;
    margin-top: min(3vw, 20px);
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .upload-area:hover {
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.05);
  }
  
  .upload-area i {
    font-size: min(8vw, 3rem);
    margin-bottom: min(2vw, 10px);
    color: var(--secondary);
  }
  
  .upload-area p {
    margin-bottom: min(2vw, 10px);
    opacity: 0.8;
    font-size: min(3.5vw, 1rem);
  }
  
  .small {
    font-size: min(3vw, 0.8rem) !important;
  }
  
  #musicFile {
    display: none;
  }
  
  .particle {
    position: absolute;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    pointer-events: none;
    opacity: 0.7;
    z-index: 1;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes pop {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.2); }
    100% { transform: scale(1); }
  }
  
  @keyframes fadeInOut {
    0% { opacity: 0; transform: scale(0.8); }
    20% { opacity: 1; transform: scale(1.1); }
    80% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(0.8); }
  }
  
  @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
    100% { transform: translateY(0px); }
  }
  
  .level-up-particles {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
  }
  
  .floating {
    animation: float 4s ease-in-out infinite;
  }
  
  .floating.delay-1 { animation-delay: 0.2s; }
  .floating.delay-2 { animation-delay: 0.4s; }
  .floating.delay-3 { animation-delay: 0.6s; }
  
  .instructions {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 15px;
    margin-top: 10px;
    max-width: 900px;
    width: 100%;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .instructions h3 {
    color: var(--warning);
    margin-bottom: 10px;
    text-align: center;
  }
  
  .instructions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }
  
  .instruction-item {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .instruction-item i {
    font-size: 24px;
    color: var(--accent);
  }
  
  @media (max-width: 600px) {
    .game-container {
      flex-direction: column;
      align-items: center;
    }
    
    .controls {
      width: 100%;
      justify-content: space-around;
    }
    
    .btn {
      min-width: 45%;
      padding: 12px 5px;
    }
    
    .instruction-item {
      font-size: 14px;
    }
  }
  
  @media (max-width: 400px) {
    .btn span {
      display: none;
    }
    
    .btn {
      min-width: 40%;
    }
  }
</style>
</head>
<body>
  <div class="header">
    <h1>Next Game Experience</h1>
    <p>A rhythm-infused runner game with immersive audio and stunning visuals</p>
  </div>
  
  <div class="game-container">
    <div id="game-wrapper" tabindex="0" aria-label="Full screen runner game. Tap or press space to jump or restart.">
      <div class="level-up-particles"></div>
      <div id="baseline"></div>
      <div id="player" class="floating"></div>
      <div id="gameOver">Game Over! Press Space or Tap to Restart</div>
      <div id="levelUp"></div>
      <div id="info">
        <div>Score: <span id="score">0</span></div>
        <div>Level: <span id="level">1</span></div>
      </div>
    </div>
    
    <div class="music-panel">
      <h2>Music Experience</h2>
      
      <div class="visualizer" id="visualizer">
        <!-- Bars will be generated by JS -->
      </div>
      
      <div class="music-controls">
        <button class="music-btn" id="playBtn" aria-label="Play"><i class="fas fa-play"></i></button>
        <button class="music-btn" id="pauseBtn" aria-label="Pause"><i class="fas fa-pause"></i></button>
        <button class="music-btn" id="stopBtn" aria-label="Stop"><i class="fas fa-stop"></i></button>
        <button class="music-btn" id="volUpBtn" aria-label="Volume Up"><i class="fas fa-volume-up"></i></button>
        <button class="music-btn" id="volDownBtn" aria-label="Volume Down"><i class="fas fa-volume-down"></i></button>
      </div>
      
      <div class="upload-area" id="uploadArea">
        <div><i class="fas fa-cloud-upload-alt"></i></div>
        <p>Upload your own music file</p>
        <p class="small">(MP3, WAV, OGG formats supported)</p>
        <input type="file" id="musicFile" accept="audio/*" />
      </div>
    </div>
  </div>
  
  <div class="controls">
    <button class="btn jump" id="jumpButton">
      <i class="fas fa-arrow-up"></i> <span>JUMP</span>
    </button>
    <button class="btn" id="restartButton">
      <i class="fas fa-redo"></i> <span>RESTART</span>
    </button>
  </div>
  
  <div class="instructions">
    <h3>How to Play</h3>
    <div class="instructions-grid">
      <div class="instruction-item">
        <i class="fas fa-mobile-alt"></i>
        <div>Tap or press SPACE to jump over obstacles</div>
      </div>
      <div class="instruction-item">
        <i class="fas fa-music"></i>
        <div>Upload your own music for a custom experience</div>
      </div>
      <div class="instruction-item">
        <i class="fas fa-trophy"></i>
        <div>Score points by avoiding obstacles</div>
      </div>
      <div class="instruction-item">
        <i class="fas fa-level-up-alt"></i>
        <div>Level up every 10 points for increased challenge</div>
      </div>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Game elements
    const game = document.getElementById('game-wrapper');
    const player = document.getElementById('player');
    const scoreSpan = document.getElementById('score');
    const levelSpan = document.getElementById('level');
    const gameOverText = document.getElementById('gameOver');
    const levelUpText = document.getElementById('levelUp');
    const jumpButton = document.getElementById('jumpButton');
    const restartButton = document.getElementById('restartButton');
    const uploadArea = document.getElementById('uploadArea');
    const musicFileInput = document.getElementById('musicFile');
    
    // Music controls
    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const stopBtn = document.getElementById('stopBtn');
    const volUpBtn = document.getElementById('volUpBtn');
    const volDownBtn = document.getElementById('volDownBtn');
    const visualizer = document.getElementById('visualizer');
    
    // Create visualizer bars
    for (let i = 0; i < 40; i++) {
      const bar = document.createElement('div');
      bar.classList.add('bar');
      bar.style.height = `${Math.random() * 80 + 10}px`;
      visualizer.appendChild(bar);
    }
    
    // Game variables
    let score = 0;
    let level = 1;
    let gameRunning = true;
    let obstacleSpeed = 3000;
    let spawnIntervalTime = 2000;
    let obstacles = [];
    let spawnInterval;
    
    let velocityY = 0;
    const gravity = 1.2;
    const jumpVelocity = 16;
    const doubleJumpVelocity = 13;
    let playerBottom = 70;
    const baselineHeight = 70;
    let jumpsDone = 0;
    const maxJumps = 2;
    
    // Audio context and elements
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let audioElement = new Audio();
    audioElement.loop = true;
    audioElement.volume = 0.6;
    
    // Default music URL
    const defaultMusicUrl = "https://actions.google.com/sounds/v1/alarms/beep_short.ogg";
    
    // Audio nodes for visualization
    let audioSource, analyser, dataArray;
    
    // Initialize audio
    function initAudio() {
      audioSource = audioCtx.createMediaElementSource(audioElement);
      analyser = audioCtx.createAnalyser();
      audioSource.connect(analyser);
      analyser.connect(audioCtx.destination);
      
      analyser.fftSize = 256;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);
    }
    
    // Load music
    function loadMusic(url) {
      if (!url) return;
      
      if (audioCtx.state === 'suspended') {
        audioCtx.resume().then(() => {
          console.log('Audio context resumed');
        });
      }
      
      if (audioElement.src !== url) {
        audioElement.pause();
        audioElement.src = url;
        audioElement.load();
      }
      
      audioElement.play().catch((e) => {
        console.log('Audio play blocked:', e);
      });
      
      // Initialize audio nodes if not done
      if (!audioSource) {
        initAudio();
      }
    }
    
    // Play default music on start
    loadMusic(defaultMusicUrl);
    
    // Create obstacle function
    function createObstacle() {
      if (!gameRunning) return;
      
      const obstacle = document.createElement('div');
      obstacle.classList.add('obstacle');
      
      const heightPx = 30 + Math.random() * 40;
      obstacle.style.height = heightPx + 'px';
      
      obstacle.style.right = '-40px';
      obstacle.style.bottom = baselineHeight + 'px';
      
      game.appendChild(obstacle);
      obstacles.push(obstacle);
      
      let start = null;
      function moveObstacle(timestamp) {
        if (!start) start = timestamp;
        const elapsed = timestamp - start;
        const progress = elapsed / obstacleSpeed;
        const gameWidth = game.clientWidth;
        
        if (progress < 1) {
          obstacle.style.right = (progress * (gameWidth + 40)) + 'px';
          
          if (detectCollision(player, obstacle)) {
            endGame();
            return;
          }
          
          requestAnimationFrame(moveObstacle);
        } else {
          if (obstacle.parentElement) obstacle.parentElement.removeChild(obstacle);
          obstacles = obstacles.filter(o => o !== obstacle);
          incrementScore();
        }
      }
      requestAnimationFrame(moveObstacle);
    }
    
    // Collision detection
    function detectCollision(player, obstacle) {
      const pRect = player.getBoundingClientRect();
      const oRect = obstacle.getBoundingClientRect();
      
      return !(
        pRect.top > oRect.bottom ||
        pRect.bottom < oRect.top ||
        pRect.right < oRect.left ||
        pRect.left > oRect.right
      );
    }
    
    // Create particles for effects
    function createParticles(x, y, color, count = 20) {
      const container = document.querySelector('.level-up-particles');
      
      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        particle.style.backgroundColor = color;
        particle.style.width = `${Math.random() * 12 + 5}px`;
        particle.style.height = particle.style.width;
        
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 80 + 40;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed;
        
        container.appendChild(particle);
        
        // Animate particle
        const duration = Math.random() * 1200 + 400;
        particle.animate([
          { transform: `translate(0, 0)`, opacity: 1 },
          { transform: `translate(${vx}px, ${vy}px)`, opacity: 0 }
        ], {
          duration: duration,
          easing: 'ease-out'
        }).onfinish = () => {
          particle.remove();
        };
      }
    }
    
    // Update visualizer
    function updateVisualizer() {
      if (!analyser) return;
      
      analyser.getByteFrequencyData(dataArray);
      const bars = visualizer.querySelectorAll('.bar');
      
      for (let i = 0; i < bars.length; i++) {
        const value = dataArray[i % dataArray.length] / 255;
        const height = value * 90 + 10;
        bars[i].style.height = `${height}px`;
        
        // Add color effect based on level
        const hue = (level * 20) % 360;
        bars[i].style.background = `linear-gradient(to top, hsl(${hue}, 100%, 60%), hsl(${(hue + 30) % 360}, 100%, 70%)`;
      }
      
      requestAnimationFrame(updateVisualizer);
    }
    
    // Start visualizer
    updateVisualizer();
    
    // Play sound effect
    function playSoundEffect(type) {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);
      
      let frequency = 440;
      let duration = 0.3;
      
      switch (type) {
        case 'jump':
          frequency = 600 + Math.random() * 100;
          duration = 0.1;
          break;
        case 'gameOver':
          frequency = 220;
          duration = 0.8;
          break;
        case 'levelUp':
          frequency = 880;
          duration = 0.4;
          // Announce level
          if ('speechSynthesis' in window) {
            const speech = new SpeechSynthesisUtterance(`Level ${level}`);
            speech.rate = 1.2;
            speech.pitch = 1.3;
            window.speechSynthesis.speak(speech);
          }
          break;
      }
      
      oscillator.type = 'sine';
      oscillator.frequency.value = frequency;
      gainNode.gain.value = 0.3;
      
      oscillator.start();
      gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
      oscillator.stop(ctx.currentTime + duration);
    }
    
    // Show level up effect
    function showLevelUp() {
      levelUpText.textContent = `LEVEL ${level} UP!`;
      levelUpText.classList.add('show');
      playSoundEffect('levelUp');
      
      // Create particles
      const rect = game.getBoundingClientRect();
      createParticles(rect.width / 2, rect.height / 2, '#4ade80', 50);
      
      setTimeout(() => {
        levelUpText.classList.remove('show');
      }, 2000);
    }
    
    // Update score and level
    function incrementScore() {
      score++;
      scoreSpan.textContent = score;
      scoreSpan.style.animation = 'pop 0.3s ease';
      
      setTimeout(() => {
        scoreSpan.style.animation = '';
      }, 300);
      
      if (score % 10 === 0) {
        level++;
        levelSpan.textContent = level;
        levelSpan.style.animation = 'pop 0.3s ease';
        
        setTimeout(() => {
          levelSpan.style.animation = '';
        }, 300);
        
        obstacleSpeed = Math.max(800, obstacleSpeed - 300);
        spawnIntervalTime = Math.max(600, spawnIntervalTime - 200);
        
        clearInterval(spawnInterval);
        spawnInterval = setInterval(createObstacle, spawnIntervalTime);
        
        showLevelUp();
      }
    }
    
    // End game
    function endGame() {
      gameRunning = false;
      gameOverText.style.display = 'block';
      playSoundEffect('gameOver');
      clearInterval(spawnInterval);
      obstacles.forEach(o => o.remove());
      obstacles = [];
      audioElement.pause();
      
      // Create game over particles
      const rect = player.getBoundingClientRect();
      createParticles(rect.left + rect.width/2, rect.top + rect.height/2, '#ef4444', 80);
    }
    
    // Restart game
    function restartGame() {
      if (gameRunning) return;
      score = 0;
      level = 1;
      scoreSpan.textContent = score;
      levelSpan.textContent = level;
      obstacleSpeed = 3000;
      spawnIntervalTime = 2000;
      gameRunning = true;
      gameOverText.style.display = 'none';
      spawnInterval = setInterval(createObstacle, spawnIntervalTime);
      playerBottom = baselineHeight;
      velocityY = 0;
      jumpsDone = 0;
      player.style.bottom = playerBottom + 'px';
      audioElement.play().catch(() => {
        console.log('Audio play blocked, waiting for user interaction.');
      });
    }
    
    // Update player position
    function updatePlayerPosition() {
      playerBottom += velocityY;
      velocityY -= gravity;
      
      if (playerBottom <= baselineHeight) {
        playerBottom = baselineHeight;
        velocityY = 0;
        jumpsDone = 0;
      }
      
      player.style.bottom = playerBottom + 'px';
    }
    
    // Jump action
    function jump() {
      if (!gameRunning) return;
      
      if (jumpsDone < maxJumps) {
        if (jumpsDone === 0) {
          velocityY = jumpVelocity;
        } else if (jumpsDone === 1) {
          velocityY = doubleJumpVelocity;
        }
        jumpsDone++;
        playSoundEffect('jump');
        player.style.transform = 'scale(0.8)';
        setTimeout(() => {
          player.style.transform = '';
        }, 200);
      }
    }
    
    // Game loop
    function gameLoop() {
      if (gameRunning) {
        updatePlayerPosition();
      }
      requestAnimationFrame(gameLoop);
    }
    
    // Event listeners
    game.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        e.preventDefault();
        if (gameRunning) jump();
        else restartGame();
      }
    });
    
    game.addEventListener('touchstart', e => {
      e.preventDefault();
      if (gameRunning) jump();
      else restartGame();
    }, { passive: false });
    
    game.addEventListener('mousedown', e => {
      if (gameRunning) jump();
      else restartGame();
    });
    
    jumpButton.addEventListener('click', e => {
      e.preventDefault();
      if (gameRunning) jump();
      else restartGame();
    });
    
    restartButton.addEventListener('click', restartGame);
    
    // Music controls
    playBtn.addEventListener('click', () => {
      audioElement.play();
    });
    
    pauseBtn.addEventListener('click', () => {
      audioElement.pause();
    });
    
    stopBtn.addEventListener('click', () => {
      audioElement.pause();
      audioElement.currentTime = 0;
    });
    
    volUpBtn.addEventListener('click', () => {
      audioElement.volume = Math.min(1, audioElement.volume + 0.1);
    });
    
    volDownBtn.addEventListener('click', () => {
      audioElement.volume = Math.max(0, audioElement.volume - 0.1);
    });
    
    // Upload music
    uploadArea.addEventListener('click', () => {
      musicFileInput.click();
    });
    
    musicFileInput.addEventListener('change', e => {
      if (!e.target.files.length) return;
      const file = e.target.files[0];
      const fileURL = URL.createObjectURL(file);
      loadMusic(fileURL);
    });
    
    // Start game on load
    window.onload = () => {
      game.focus();
      player.style.bottom = playerBottom + 'px';
      spawnInterval = setInterval(createObstacle, spawnIntervalTime);
      requestAnimationFrame(gameLoop);
      
      // Create background particles
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        particle.classList.add('floating');
        particle.classList.add(`delay-${i % 3}`);
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.width = `${Math.random() * 15 + 5}px`;
        particle.style.height = particle.style.width;
        particle.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;
        particle.style.opacity = Math.random() * 0.5 + 0.1;
        document.body.appendChild(particle);
      }
    };
  });
</script>
</body>
</html>
